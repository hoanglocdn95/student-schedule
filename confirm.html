<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Xác Nhận Thời Gian Rảnh</title>
    <style>
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        border: 1px solid black;
        text-align: center;
        padding: 8px;
      }
      th {
        background-color: #f2f2f2;
      }
    </style>
  </head>
  <body>
    <h2>Xác Nhận Thời Gian Rảnh</h2>
    <table id="confirmTable">
      <thead>
        <tr>
          <th>Buổi</th>
          <th>Thứ 2 (10/3/2025)</th>
          <th>Thứ 3 (11/3/2025)</th>
          <th>Thứ 4 (12/3/2025)</th>
          <th>Thứ 5 (13/3/2025)</th>
          <th>Thứ 6 (14/3/2025)</th>
          <th>Thứ 7 (15/3/2025)</th>
          <th>Chủ Nhật (16/3/2025)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <br />
    <button onclick="goBack()">Cancel</button>
    <button onclick="submitToGoogleSheets()">Yes</button>

    <script>
      const scheduleData = JSON.parse(sessionStorage.getItem("scheduleData"));
      const tbody = document.querySelector("#confirmTable tbody");

      const timeSlots = [
        "Sáng (8h - 12h)",
        "Chiều (12h - 17h)",
        "Tối (17h - 23h)",
      ];

      scheduleData.forEach((row, index) => {
        const tr = document.createElement("tr");

        // Thêm cột "Buổi"
        const timeSlotCell = document.createElement("td");
        timeSlotCell.textContent = timeSlots[index];
        tr.appendChild(timeSlotCell);

        // Thêm dữ liệu cho các ngày
        row.forEach((cell) => {
          const td = document.createElement("td");
          td.textContent = cell;
          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      });

      function goBack() {
        window.location.href = "index.html";
      }

      const GOOGLE_API_URL =
        "https://script.google.com/macros/s/AKfycbw-LDaVqZztFmhdH8nhnQ78Yd49UV8fBQpFXjgpIatrd_fJR8574LJ3kZWmth1kiyV06A/exec";

      function submitToGoogleSheets() {
        fetch(GOOGLE_API_URL, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(scheduleData),
        })
          .then((response) => response.json())
          .then((data) => alert("Dữ liệu đã được lưu!"))
          .catch((error) => {
            console.log(" submitToGoogleSheets ~ error:", error);
          });
      }
    </script>
  </body>
</html>
